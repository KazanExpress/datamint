{"version":3,"file":"webalorm.iife.js","sources":["../src/decorators/index.ts","../src/debug/module.ts","../src/debug/debugable.ts","../src/debug/index.ts","../src/drivers/base.ts","../src/drivers/fallback.ts","../src/drivers/multiDriver.ts","../src/repository/base.ts","../src/repository/broken.ts","../src/queryResult.ts","../src/repository/entity.ts","../src/storable/storable.ts","../src/storable/entity.ts","../src/storable/record.ts","../src/repository/record.ts","../src/repository/factory.ts","../src/orm/connection.ts","../src/orm/index.ts","../src/decorators/logs.ts"],"sourcesContent":["export const enumerable = (isEnumerable: boolean = true) => function (target: object, key: string, desc?: PropertyDescriptor) {\r\n  if (desc) {\r\n    desc.enumerable = isEnumerable;\r\n  } else {\r\n    Reflect.deleteProperty(target, key);\r\n    Reflect.defineProperty(target, key, {\r\n      value: undefined,\r\n      enumerable: isEnumerable,\r\n      writable: true\r\n    });\r\n  }\r\n};\r\n","const LOG_PREFIX = (name: string) => name ? `[webalorm:${name}]` : `[webalorm]`;\r\n\r\n/**\r\n * A type of debug errors\r\n *\r\n * - `soft` - informative, only logs to console\r\n * - `hard` - throws exceptions, forcing proper error-handling\r\n */\r\nexport type ExceptionType = 'soft' | 'hard';\r\n\r\n/**\r\n * Dictates the type of debug to set\r\n *\r\n * - `*` - debug everything\r\n * - `connection` - debug the orm connection\r\n * - `driver` - debug all drivers\r\n * - `driver:${name}` - debug a driver with ${name}\r\n * - `db` - debug all repositories\r\n * - `db:${name}` - debug a repo with ${name}\r\n * - `db:${name}:entity` - debug all entities in the repository\r\n */\r\nexport type DebugType = '*'\r\n  | 'connection'\r\n  | 'driver'\r\n  // tslint:disable-next-line:no-invalid-template-strings - Need this for correct autocomplete\r\n  | 'driver:${name}'\r\n  | 'db'\r\n  // tslint:disable-next-line:no-invalid-template-strings - Need this for correct autocomplete\r\n  | 'db:${name}'\r\n  // tslint:disable-next-line:no-invalid-template-strings - Need this for correct autocomplete\r\n  | 'db:${name}:entity';\r\n\r\nexport type DebugState = 'enabled' | 'disabled' | 'custom';\r\n\r\n/**\r\n * Maps all debug types to all errors types, telling which debug type will throw\r\n */\r\nexport type DebugMap = Partial<{\r\n  [key: string]: boolean | ExceptionType;\r\n}>;\r\n\r\nexport type LogLevel = 'log' | 'debug' | 'warn' | 'error';\r\n\r\n\r\n/**\r\n * Shows the current debug state of WEBALORM\r\n *\r\n * - `enabled` - all the logs and exceptions are enabled\r\n * - `custom` - custom rules are set via a `debug()` function\r\n * - `disabled` - all the logs and most exceptions are suppressed\r\n */\r\nexport let debugState: DebugState = 'disabled';\r\n\r\n\r\n/**\r\n * Contains the map for all debug types and their respective error types for the ORM.\r\n */\r\nexport const debugMap: DebugMap = {};\r\n\r\nexport function setDebugState(state: DebugState) {\r\n  debugState = state;\r\n}\r\n\r\n\r\n\r\n/**\r\n * Returns the current error type for a specific type of debugging\r\n */\r\nexport function errorTypeFor(type: string): boolean | ExceptionType;\r\nexport function errorTypeFor(type: RegExp): boolean | ExceptionType;\r\nexport function errorTypeFor(type: DebugType): boolean | ExceptionType;\r\nexport function errorTypeFor(type: string | RegExp | DebugType): boolean | ExceptionType {\r\n  if (debugMap['*']) { return debugMap['*']!; }\r\n\r\n  const isString = (t): t is string => typeof t === 'string';\r\n\r\n  if (isString(type) && debugMap[type]) {\r\n    return debugMap[type]!;\r\n  }\r\n\r\n  if (isString(type)) {\r\n    const matchingType = Object.keys(debugMap)\r\n      .find(t => !!t && t.includes(type) && !!debugMap[t]) as ExceptionType | undefined;\r\n\r\n    return matchingType || false;\r\n  }\r\n\r\n  return (Object.keys(debugMap).find(t => type.test(t)) as ExceptionType | undefined) || false;\r\n}\r\n\r\n\r\nexport function print(instanceName: string, type: any, message: any, level: LogLevel, force: boolean = false) {\r\n  if ((debugState !== 'disabled') || force) {\r\n    const errorType = errorTypeFor(type);\r\n    if (errorType) {\r\n      if (errorType === 'hard' && level === 'error') {\r\n        throw new Error(`${LOG_PREFIX(instanceName)}:${type} - ${message}`);\r\n      } else {\r\n        console[level](`%c${LOG_PREFIX(instanceName)}%c:%c${type}%c - ${message}`,\r\n          'color: purple',\r\n          'color: initial',\r\n          'color: blue',\r\n          'color: initial'\r\n        );\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { enumerable } from '../decorators';\r\nimport { DebugType, errorTypeFor, LogLevel, print } from './module';\r\n\r\nexport abstract class Debugable {\r\n  /**\r\n   * The debug type for this class' actions\r\n   */\r\n  @enumerable(false)\r\n  protected readonly abstract $debugType: DebugType;\r\n\r\n  /**\r\n   * The name of the WEBALORM connection this class uses\r\n   */\r\n  @enumerable(false)\r\n  protected readonly abstract $connectionName: string;\r\n\r\n  /**\r\n   * `true` if the debug is enabled for this class\r\n   */\r\n  @enumerable(false)\r\n  public get $debugEnabled() { return errorTypeFor(this.$debugType); }\r\n\r\n  @enumerable(false)\r\n  private readonly $logFactory = (level: LogLevel) => (message, force: boolean = false) =>\r\n      print(this.$connectionName, this.$debugType, message, level, force);\r\n\r\n  @enumerable(false)\r\n  protected readonly $log = this.$logFactory('log');\r\n  @enumerable(false)\r\n  protected readonly $warn = this.$logFactory('warn');\r\n  @enumerable(false)\r\n  protected readonly $error = this.$logFactory('error');\r\n  @enumerable(false)\r\n  protected readonly $debug = this.$logFactory('debug');\r\n}\r\n","import { Debugable } from './debugable';\r\nimport { debugMap, debugState, DebugType } from './module';\r\n\r\nclass GlobalDebug extends Debugable {\r\n  protected $debugType: DebugType = '*';\r\n  protected $connectionName: string = '';\r\n  private constructor() { super(); }\r\n\r\n  public static instance = new GlobalDebug();\r\n\r\n  public $log!: Debugable['$log'];\r\n  public $warn!: Debugable['$warn'];\r\n  public $error!: Debugable['$error'];\r\n  public $debug!: Debugable['$debug'];\r\n\r\n  public get map() {\r\n    return debugMap;\r\n  }\r\n\r\n  public get state() {\r\n    return debugState;\r\n  }\r\n}\r\n\r\nexport const Debug = GlobalDebug.instance;\r\n\r\nexport * from './debugable';\r\nexport * from './module';\r\n\r\n","import { Connection } from '../orm';\r\nimport { IRepoData } from '../repository';\r\n\r\nexport interface IDriverConstructor extends Function {\r\n  new (connection: Connection): Driver;\r\n\r\n  readonly isSupported: boolean;\r\n}\r\n\r\nexport abstract class Driver {\r\n  constructor(\r\n    protected connection: Connection\r\n  ) {}\r\n\r\n  /* TODO: additional driver functionality?.. */\r\n\r\n\r\n  public abstract create<A, R extends IRepoData = IRepoData>(\r\n    repository: R,\r\n    data: A\r\n  ): Promise<A>;\r\n\r\n  public abstract read<A, R extends IRepoData = IRepoData>(\r\n    repository: R,\r\n    id: any\r\n  ): Promise<A>;\r\n\r\n  public abstract update<A, R extends IRepoData = IRepoData>(\r\n    repository: R,\r\n    id: any,\r\n    query: (data: A) => Partial<A>\r\n  ): Promise<A>;\r\n  public abstract update<A, R extends IRepoData = IRepoData>(\r\n    repository: R,\r\n    data: Partial<A>\r\n  ): Promise<A>;\r\n\r\n  public abstract delete<A, R extends IRepoData = IRepoData>(\r\n    repository: R,\r\n    id: any\r\n  ): Promise<A>;\r\n\r\n  /**\r\n   * Determines if the driver is supported in current environment\r\n   */\r\n  static get isSupported(): boolean {\r\n    throw new Error('Not implemented.');\r\n  }\r\n}\r\n","import { IRepoData, IEntityRepoData } from '../repository';\r\nimport { Driver } from './base';\r\n\r\nconst isEntityRepo = (r): r is IEntityRepoData<any> => !!(r as IEntityRepoData<any>).columns;\r\n\r\n/* TODO: driver that just writes everything to short-term memory */\r\nexport class FallbackDriver extends Driver {\r\n  public async create<A, R extends IRepoData = IRepoData>(repository: R, data: A): Promise<A> {\r\n    if (isEntityRepo(repository)) {\r\n      this.repositoryMap[repository.name] = {};\r\n\r\n      this.repositoryMap[repository.name][data[repository.primaryKey]] = data;\r\n    } else {\r\n      this.repositoryMap[repository.name] = data;\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  public read<A, R extends IRepoData = IRepoData>(repository: R, id: any): Promise<A> {\r\n    if (isEntityRepo(repository)) {\r\n      return this.repositoryMap[repository.name][id];\r\n    }\r\n\r\n    return this.repositoryMap[repository.name];\r\n  }\r\n\r\n  public update<A, R extends IRepoData = IRepoData>(repository: R, id: any, query: (data: A) => Partial<A>): Promise<A>;\r\n  public update<A, R extends IRepoData = IRepoData>(repository: R, data: Partial<A>): Promise<A>;\r\n  public update(repository: any, id: any, query?: any) {\r\n    throw new Error('Method not implemented.');\r\n\r\n    return Promise.resolve();\r\n  }\r\n\r\n  public delete<A, R extends IRepoData = IRepoData>(repository: R, entity: any): Promise<A> {\r\n    const repo = this.repositoryMap[repository.name];\r\n\r\n    let res;\r\n\r\n    if (isEntityRepo(repository)) {\r\n      const key = Object.keys(repo).findIndex(e => Object.keys(repo[e]).some(key => {\r\n        return e[key] === entity[key];\r\n      }));\r\n\r\n      res = this.repositoryMap[repository.name][key];\r\n\r\n      this.repositoryMap[repository.name][key] = undefined;\r\n\r\n      delete this.repositoryMap[repository.name][key];\r\n    } else {\r\n      res = this.repositoryMap[repository.name];\r\n\r\n      this.repositoryMap[repository.name] = undefined;\r\n    }\r\n\r\n    return res;\r\n  }\r\n\r\n  private repositoryMap: any = {};\r\n}\r\n","import { Connection } from '../orm';\r\nimport { IRepoData } from '../repository';\r\nimport { Driver, IDriverConstructor } from './base';\r\n\r\nexport class MultiDriver extends Driver {\r\n  private drivers: Driver[];\r\n\r\n  constructor(\r\n    connection: Connection,\r\n    drivers: IDriverConstructor[]\r\n  ) {\r\n    super(connection);\r\n\r\n    this.drivers = drivers.filter(d => d.isSupported).map(D => new D(connection));\r\n  }\r\n\r\n  private request(type: 'create' | 'update' | 'read' | 'delete') {\r\n    return function (this: MultiDriver) {\r\n      const args = arguments;\r\n      const allResponses = Promise.all(this.drivers.map(d => d[type].apply(d, args)));\r\n\r\n      return allResponses[0];\r\n    }.bind(this);\r\n  }\r\n\r\n  public readonly create: {\r\n    <A, R extends IRepoData = IRepoData>(repository: R, data: A): Promise<A>;\r\n  } = this.request('create');\r\n\r\n  public readonly read: {\r\n    <A, R extends IRepoData = IRepoData>(repository: R, id: any): Promise<A>;\r\n  } = this.request('read');\r\n\r\n  public readonly update: {\r\n    <A, R extends IRepoData = IRepoData>(repository: R, id: any, query: (data: A) => Partial<A>): Promise<A>;\r\n    <A, R extends IRepoData = IRepoData>(repository: R, data: Partial<A>): Promise<A>;\r\n  } = this.request('update');\r\n\r\n  public readonly delete: {\r\n    <A, R extends IRepoData = IRepoData>(repository: R, id: any): Promise<A>;\r\n  } = this.request('delete');\r\n\r\n  public static get isSupported() { return true; }\r\n}\r\n","import { DataMap } from '../apiMap';\r\nimport { Debug, Debugable, DebugType } from '../debug';\r\nimport { Driver } from '../drivers';\r\nimport { IStorableConstructor, Storable } from '../storable';\r\n\r\nexport interface IRepoConnectionInternal {\r\n  name: string;\r\n  currentDriver: Driver;\r\n}\r\n\r\nexport interface IRepoConnection<DM> extends IRepoConnectionInternal {\r\n  apiMap: DM;\r\n}\r\n\r\nexport interface IRepoData {\r\n  name: string;\r\n}\r\n\r\nexport type FromSecArg<\r\n  T extends undefined | ((arg: any, other: any) => any)\r\n> = T extends ((arg: any, other: infer U) => any) ? U : undefined;\r\n\r\nexport abstract class Repository<\r\n  DM extends DataMap<C> | undefined,\r\n  C extends IStorableConstructor<E>,\r\n  E extends Storable = InstanceType<C>,\r\n  A extends ConstructorParameters<C>[0] = ConstructorParameters<C>[0],\r\n> extends Debugable implements IRepoData {\r\n  protected readonly $debugType: DebugType = `db:${this.name.toLowerCase()}` as DebugType;\r\n  protected readonly connection: IRepoConnectionInternal;\r\n  public readonly $connectionName: string;\r\n\r\n  constructor(\r\n    public name: string,\r\n    connection: IRepoConnection<DM>,\r\n    private Data: C\r\n  ) {\r\n    super();\r\n    this.connection = connection;\r\n    this.$connectionName = connection.name;\r\n\r\n    this.api = connection.apiMap;\r\n\r\n    if (/* this class was instantiated directly (without inheritance) */\r\n      Repository.prototype === this.constructor.prototype\r\n    ) {\r\n      if (this.$debugEnabled) {\r\n        this.$warn(`Using default empty repository.`);\r\n      } else {\r\n        Debug.$warn(`Using default empty repository for ${name}`, true);\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  protected readonly api: DM;\r\n\r\n  protected makeDataInstance(options: A) {\r\n    return new this.Data(options, this);\r\n  }\r\n}\r\n","import { BrokenDataMap } from '../apiMap';\r\nimport { Repository } from './base';\r\n\r\nexport class BrokenRepository<DM extends BrokenDataMap<any>> extends Repository<DM, any> {\r\n  public get API() {\r\n    return this.api;\r\n  }\r\n}\r\n","/**\r\n * Incapsulates the query result data for further manipulation\r\n *\r\n * @template T the type of data encapsulated\r\n */\r\nexport class QueryResult<T> {\r\n  private _ok: boolean;\r\n  private _result: T;\r\n  private _error?: Error;\r\n  private handlers: ((error?: Error, result?: T) => any)[] = [];\r\n\r\n  constructor(ok: boolean, result: T, error?: Error) {\r\n    this._ok = ok;\r\n    this._result = result;\r\n    this._error = error;\r\n  }\r\n\r\n  /**\r\n   * Determines whether the incapsulated data is OK and contains no errors\r\n   */\r\n  public get ok() { return this._ok; }\r\n\r\n  /**\r\n   * The resulting data of the query request\r\n   */\r\n  public get result() { return this._result; }\r\n  public set result(value) {\r\n    this._ok = true;\r\n    this._result = value;\r\n    this.handlers.forEach(h => h(this.error, this.result));\r\n  }\r\n\r\n  /**\r\n   * The error of the query (if any)\r\n   */\r\n  public get error() { return this._error; }\r\n  public set error(value) {\r\n    this._ok = false;\r\n    this._error = value;\r\n    this.handlers.forEach(h => h(this.error, this.result));\r\n  }\r\n\r\n  /**\r\n   * Fires a handler whenever the data in the result has been changed\r\n   *\r\n   * @param callback the callback to fire\r\n   */\r\n  public onChange(callback: (error?: Error, result?: T) => any) {\r\n    this.handlers.push(callback);\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe the callback from the result data changes\r\n   */\r\n  public offChange(callback: (error?: Error, result?: T) => any) {\r\n    const idx = this.handlers.indexOf(callback);\r\n\r\n    if (idx > -1) {\r\n      this.handlers.splice(idx, 1);\r\n    }\r\n  }\r\n}\r\n","import { EntityDataMap } from '../apiMap';\r\nimport { QueryResult } from '../queryResult';\r\nimport { Entity, IStorableConstructor } from '../storable';\r\nimport { IRepoConnection, IRepoData, Repository, FromSecArg } from './base';\r\n\r\ntype PartialWithId<T, ID, IDKey extends PropertyKey> = Partial<T> & {\r\n  [key in IDKey]: ID;\r\n};\r\n\r\nexport interface IEntityRepoData<IDKey extends PropertyKey> extends IRepoData {\r\n  readonly columns: Array<string>;\r\n  readonly primaryKey: IDKey;\r\n}\r\n\r\nexport interface IEntityRepoMethods<\r\n  C extends IStorableConstructor<E>,\r\n  E extends Entity = InstanceType<C>,\r\n  A extends ConstructorParameters<C>[0] = ConstructorParameters<C>[0],\r\n  ID = E extends Entity<string, infer IdType> ? IdType : any,\r\n  IDKey extends PropertyKey = E extends Entity<infer IdKey, unknown> ? IdKey : string,\r\n> {\r\n  add(\r\n    options: A,\r\n    apiOptions?: any\r\n  ): Promise<any>;\r\n\r\n  get(\r\n    id: ID,\r\n    apiOptions?: any\r\n  ): Promise<any>;\r\n\r\n  update(\r\n    entity: PartialWithId<A, ID, IDKey> | ID,\r\n    deleteApiOptions?: any\r\n  ): Promise<any>;\r\n\r\n  delete(\r\n    entity: PartialWithId<A, ID, IDKey> | ID,\r\n    deleteApiOptions?: any\r\n  ): Promise<any>;\r\n\r\n  //...\r\n  // TODO - other methods\r\n}\r\n\r\n/**\r\n * A typical multi-entity repository.\r\n *\r\n * @template `DM` API data map for the repo\r\n * @template `C` entity constructor type\r\n * @template `E` entity instance type\r\n * @template `A` entity constructor parameter options\r\n * @template `ID` entity primary key type\r\n * @template `IDKey` entity primary key name\r\n */\r\nexport class EntityRepository<\r\n  DM extends EntityDataMap<C>,\r\n  C extends IStorableConstructor<E>,\r\n  E extends Entity = InstanceType<C>,\r\n  A extends ConstructorParameters<C>[0] = ConstructorParameters<C>[0],\r\n  ID = E extends Entity<string, infer IdType> ? IdType : any,\r\n  IDKey extends PropertyKey = E extends Entity<infer IdKey, unknown> ? IdKey : string,\r\n> extends Repository<DM, C, E, A> implements IEntityRepoData<IDKey>, IEntityRepoMethods<C, E, A, ID, IDKey> {\r\n\r\n  public readonly columns: Array<string> = [];\r\n  public readonly primaryKey: IDKey;\r\n\r\n  constructor(\r\n    name: string,\r\n    connection: IRepoConnection<DM>,\r\n    entity: C\r\n  ) {\r\n    super(name, connection, entity);\r\n    this.primaryKey = entity.prototype.__id__;\r\n\r\n    if (entity.prototype.__col__) {\r\n      this.columns = Object.keys(entity.prototype.__col__);\r\n      delete entity.prototype.__col__;\r\n    } else {\r\n      this.columns = Object.keys(new entity({}, this));\r\n    }\r\n  }\r\n\r\n  private get driverOptions(): IEntityRepoData<IDKey> {\r\n    return {\r\n      name: this.name,\r\n      columns: this.columns,\r\n      primaryKey: this.primaryKey\r\n    };\r\n  }\r\n\r\n  public async add(\r\n    options: A,\r\n    // TODO: up to debate - singular arguments always or multiple args inference?\r\n    apiOptions?: FromSecArg<DM['add']> | false // Pass false to disable the api call\r\n  ) {\r\n    try {\r\n      const result = await this.connection.currentDriver.create<A, IEntityRepoData<IDKey>>(this.driverOptions, options);\r\n\r\n      const instance = this.makeDataInstance(result);\r\n\r\n      // Call local driver changes synchronously\r\n      const queryResult = new QueryResult(true, instance);\r\n\r\n      // Call api driver asynchronously\r\n      if (this.api && this.api.add && apiOptions !== false) {\r\n        this.$log(`API handler execution start: ${this.name}.add()`);\r\n\r\n        // @TODO: implement async request queue\r\n        this.api.add(options, apiOptions).then(res => {\r\n          queryResult.result = this.makeDataInstance(res);\r\n          this.$log(`API handler execution end: ${this.name}.add() => ${JSON.stringify(res, undefined, '  ')}`);\r\n        }).catch(e => {\r\n          queryResult.error = e;\r\n          this.$error(`API handler execution end: ${this.name}.add() => ${e}`);\r\n        });\r\n      } else {\r\n        this.$log('No API handler called');\r\n      }\r\n\r\n      return queryResult;\r\n    } catch (e) {\r\n      this.$error(e);\r\n\r\n      return new QueryResult<E>(false, this.makeDataInstance(options), e);\r\n    }\r\n  }\r\n\r\n  public async get(\r\n    id: ID,\r\n    getApiOptions?: FromSecArg<DM['get']> | false\r\n  ) {\r\n    try {\r\n      const result = await this.connection.currentDriver.read<A, IEntityRepoData<IDKey>>(this.driverOptions, id);\r\n\r\n      const instance = this.makeDataInstance(result);\r\n\r\n      // Call local driver changes synchronously\r\n      const queryResult = new QueryResult(true, instance);\r\n\r\n      // Call api driver asynchronously\r\n      if (this.api && this.api.get && getApiOptions !== false) {\r\n        this.$log(`API handler execution start: ${this.name}.get()`);\r\n\r\n        // @TODO: implement async request queue\r\n        this.api.get(id as any, getApiOptions).then(res => {\r\n          queryResult.result = this.makeDataInstance(res);\r\n          this.$log(`API handler execution end: ${this.name}.get() => ${JSON.stringify(res, undefined, '  ')}`);\r\n        }).catch(e => {\r\n          queryResult.error = e;\r\n          this.$error(`API handler execution end: ${this.name}.get() => ${e}`);\r\n        });\r\n      } else {\r\n        this.$log('No API handler called');\r\n      }\r\n\r\n      return queryResult;\r\n    } catch (e) {\r\n      return new QueryResult(\r\n        false,\r\n        undefined,\r\n        e\r\n      );\r\n    }\r\n  }\r\n\r\n  public async update(\r\n    entity: PartialWithId<A, ID, IDKey>,\r\n    updateApiOptions?: FromSecArg<DM['update']>\r\n  ) {\r\n    throw new Error('Not implemented');\r\n\r\n    return new QueryResult(/* TODO: implement this */\r\n      true,\r\n      this.makeDataInstance({} as any)\r\n    );\r\n  }\r\n\r\n  /* Do we even need this?.. */\r\n  public async updateById(\r\n    id: ID,\r\n    query: (entity: E) => Partial<A>,\r\n    // updateApiOptions?: FromSecArg<DM['updateById']>\r\n  ) {\r\n    throw new Error('Not implemented');\r\n\r\n    return new QueryResult(/* TODO: implement this */\r\n      true,\r\n      this.makeDataInstance(query({} as any) as any)\r\n    );\r\n  }\r\n\r\n  public async delete(\r\n    entity: PartialWithId<A, ID, IDKey> | ID,\r\n    deleteApiOptions?: FromSecArg<DM['delete']> | false\r\n  ) {\r\n    throw new Error('Not implemented');\r\n\r\n    return new QueryResult(/* TODO: implement this */\r\n      true,\r\n      this.makeDataInstance({} as any)\r\n    );\r\n  }\r\n\r\n  // TODO: Find, find by, exists, etc...\r\n\r\n  public async count() {\r\n    // TODO: count entities\r\n  }\r\n\r\n  // TODO: Cluster operations\r\n}\r\n","import { Debugable, DebugType } from '../debug';\r\nimport { Repository } from '../repository';\r\n\r\nexport type IStorableConstructor<E extends Storable> = new (options, $repository) => E;\r\n\r\nexport abstract class Storable extends Debugable {\r\n  protected $debugType: DebugType = `db:${this.$repository.name}:entity` as DebugType;\r\n  public $connectionName: string = this.$repository.$connectionName;\r\n\r\n  constructor(\r\n    public readonly $repository: Repository<any, any>\r\n  ) { super(); }\r\n\r\n  public abstract $save(): Promise<void>;\r\n  public abstract $delete(): Promise<void>;\r\n}\r\n","import { enumerable } from '../decorators';\r\nimport { Repository } from '../repository';\r\nimport { Storable } from './storable';\r\n\r\nexport class Entity<\r\n  IDKey extends PropertyKey = string,\r\n  ID = any\r\n> extends Storable {\r\n  // TODO: check to be writable\r\n  @enumerable(false)\r\n  private __col__: Array<string> = [];\r\n\r\n  @enumerable(false)\r\n  private __idCol__?: IDKey;\r\n\r\n  @enumerable(false)\r\n  private __idValue__?: ID;\r\n\r\n  constructor(\r\n    options,\r\n    $repository: Repository<any, any>\r\n  ) {\r\n    super($repository);\r\n\r\n    if (this.__idCol__) {\r\n      this.__idValue__ = options[this.__idCol__];\r\n\r\n      Reflect.deleteProperty(this, this.__idCol__);\r\n      Reflect.defineProperty(this, this.__idCol__, {\r\n        get: () => this.__idValue__,\r\n        set: v => this.__idValue__ = v,\r\n        enumerable: true\r\n      });\r\n    }\r\n  }\r\n\r\n  @enumerable(false)\r\n  public $save(): Promise<void> {\r\n    /* TODO */\r\n    throw new Error('Method not implemented.');\r\n  }\r\n\r\n  @enumerable(false)\r\n  public $delete(): Promise<void> {\r\n    /* TODO */\r\n    throw new Error('Method not implemented.');\r\n  }\r\n\r\n  public static Column(target: typeof Entity['prototype'], key: string) {\r\n    if (!target.__col__)\r\n      target.__col__ = [];\r\n\r\n    target.__col__.push(key);\r\n  }\r\n\r\n  public static ID(target: typeof Entity['prototype'], key: string) {\r\n    target.__idCol__ = key;\r\n  }\r\n}\r\n\r\nexport const Column = Entity.Column;\r\nexport const ID = Entity.ID;\r\n","import { enumerable } from '../decorators';\r\nimport { Repository } from '../repository';\r\nimport { Storable } from './storable';\r\n\r\nexport class Record extends Storable {\r\n  constructor(\r\n    options,\r\n    $repository: Repository<any, any>\r\n  ) {\r\n    super($repository);\r\n  }\r\n\r\n  @enumerable(false)\r\n  public $save(): Promise<void> {\r\n    /* TODO */\r\n    throw new Error('Method not implemented.');\r\n  }\r\n\r\n  @enumerable(false)\r\n  public $delete(): Promise<void> {\r\n    /* TODO */\r\n    throw new Error('Method not implemented.');\r\n  }\r\n}\r\n","import { RecordDataMap } from '../apiMap';\r\nimport { QueryResult } from '../queryResult';\r\nimport { IStorableConstructor, Record } from '../storable';\r\nimport { Repository, FromSecArg } from './base';\r\n\r\nexport interface IRecordRepoMethods<\r\n  C extends IStorableConstructor<E>,\r\n  E extends Record = InstanceType<C>,\r\n  A extends ConstructorParameters<C>[0]= ConstructorParameters<C>[0]\r\n> {\r\n  create(\r\n    options: A,\r\n    apiOptions?: any\r\n  ): Promise<any>;\r\n\r\n  read(\r\n    apiOptions?: any\r\n  ): Promise<any>;\r\n\r\n  update(\r\n    options: Partial<A>,\r\n    apiOptions?: any\r\n  ): Promise<any>;\r\n\r\n  delete(\r\n    deleteApiOptions?: any\r\n  ): Promise<any>;\r\n\r\n  //...\r\n  // TODO - other methods?\r\n}\r\n\r\n/**\r\n * A single-entity repository.\r\n *\r\n * @template `DM` API data map for the repo\r\n * @template `C` entity constructor type\r\n * @template `E` entity instance type\r\n * @template `A` entity constructor parameter options\r\n */\r\nexport class RecordRepository<\r\n  DM extends RecordDataMap<C>,\r\n  C extends IStorableConstructor<E>,\r\n  E extends Record = InstanceType<C>,\r\n  A extends ConstructorParameters<C>[0]= ConstructorParameters<C>[0],\r\n> extends Repository<DM, C, E, A> implements IRecordRepoMethods<C, E ,A> {\r\n  public async create(\r\n    options: A,\r\n    apiOptions?: FromSecArg<DM['create']> | false\r\n  ) {\r\n    throw new Error('Not implemented');\r\n\r\n    return new QueryResult(/* TODO: implement this */\r\n      true,\r\n      this.makeDataInstance({} as any)\r\n    );\r\n  }\r\n\r\n  public async update(\r\n    options: Partial<A>,\r\n    apiOptions?: FromSecArg<DM['update']> | false\r\n  ) {\r\n    throw new Error('Not implemented');\r\n\r\n    return new QueryResult(/* TODO: implement this */\r\n      true,\r\n      this.makeDataInstance({} as any)\r\n    );\r\n  }\r\n\r\n  public async read(apiOptions?: FromSecArg<DM['read']> | false) {\r\n    throw new Error('Not implemented');\r\n\r\n    return new QueryResult(/* TODO: implement this */\r\n      true,\r\n      this.makeDataInstance({} as any)\r\n    );\r\n  }\r\n\r\n  public async delete(apiOptions?: FromSecArg<DM['delete']> | false) {\r\n    throw new Error('Not implemented');\r\n\r\n    return new QueryResult(/* TODO: implement this */\r\n      true,\r\n      this.makeDataInstance({} as any)\r\n    );\r\n  }\r\n}\r\n","import { DataMap, EntityDataMap, RecordDataMap } from '../apiMap';\r\nimport { print } from '../debug';\r\nimport { Entity, IStorableConstructor, Record, Storable } from '../storable';\r\nimport { IRepoConnection } from './base';\r\nimport { BrokenRepository } from './broken';\r\nimport { EntityRepository } from './entity';\r\nimport { RecordRepository } from './record';\r\n\r\nexport function makeRepository<\r\n  DM extends DataMap<C>,\r\n  C extends IStorableConstructor<E>,\r\n  E extends Storable = InstanceType<C>,\r\n  A extends ConstructorParameters<C>[0] = ConstructorParameters<C>[0],\r\n>(\r\n  name: string,\r\n  connection: IRepoConnection<DM>,\r\n  data: C\r\n): DM extends EntityDataMap<C> ? (\r\n  E extends Entity ? EntityRepository<DM, C, E, A> : BrokenRepository<DM>\r\n) : DM extends RecordDataMap<C> ? (\r\n  E extends Record ? RecordRepository<DM, C, E, A> : BrokenRepository<DM>\r\n) : BrokenRepository<DM> {\r\n  let Repo: any = BrokenRepository;\r\n\r\n  if (data.prototype instanceof Entity) {\r\n    Repo = EntityRepository;\r\n  } else if (data.prototype instanceof Record) {\r\n    Repo = RecordRepository;\r\n  } else {\r\n    print(\r\n      connection.name,\r\n      'db',\r\n      `No suitable repository found for \"${data.name}\".`,\r\n      'error'\r\n    );\r\n  }\r\n\r\n  return new Repo(name, connection, data);\r\n}\r\n","import { ApiMap, RepoFromDataMap } from '../apiMap';\r\nimport { Debug, Debugable, debugMap, DebugState, debugState, DebugType, ExceptionType, setDebugState } from '../debug';\r\nimport { Driver, IDriverConstructor } from '../drivers';\r\nimport { FallbackDriver } from '../drivers/fallback';\r\nimport { MultiDriver } from '../drivers/multiDriver';\r\nimport { makeRepository } from '../repository';\r\nimport { IStorableConstructor } from '../storable';\r\n\r\nexport interface IRepositoryMap {\r\n  [name: string]: IStorableConstructor<any>;\r\n}\r\n\r\ntype PropFrom<O, Key> = Key extends keyof O ? O[Key] : any;\r\n\r\nexport type RepoStore<M extends IRepositoryMap, A extends ApiMap<M>> = {\r\n  [Name in (keyof M | keyof A)]: RepoFromDataMap<PropFrom<M, Name>, PropFrom<A, Name>>;\r\n};\r\n\r\nexport class Connection<\r\n  RM extends IRepositoryMap = IRepositoryMap,\r\n  AM extends ApiMap<RM> = ApiMap<RM>,\r\n> extends Debugable {\r\n  protected $debugType: DebugType = `connection`;\r\n  protected $connectionName: string = this.name;\r\n\r\n  // TODO\r\n  // public static readonly plugins: WEBALORM.IPlugin[] = [];\r\n\r\n  /**\r\n   * The driver currently used for operations with entities\r\n   */\r\n  public currentDriver: Driver;\r\n\r\n  /**\r\n   * A current map of bound repositories\r\n   */\r\n  public repositories: RepoStore<RM, AM> = {} as any;\r\n\r\n  /**\r\n   * Creates a WEBALORM connection instance.\r\n   * @param name the name of the connection to the storage. Namespaces all respositories invoked from the instance.\r\n   * @param drivers determine a variety of drivers the orm can select from. The first one that fits for the environment is selected.\r\n   * @param repositories sets the relation of a repository name to its contents' prototype.\r\n   * @param apiMap maps the API calls onto the current data structure\r\n   */\r\n  constructor(\r\n    public name: string,\r\n    public drivers: IDriverConstructor[] | MultiDriver,\r\n    repositories: RM,\r\n    public readonly apiMap?: AM\r\n  ) {\r\n    super();\r\n\r\n    if (!apiMap) {\r\n      Debug.$warn('The main webalorm functionality is disabled. Are you sure you want to use this without API?', true);\r\n    }\r\n\r\n    try {\r\n      if (Array.isArray(drivers)) {\r\n        // Select the first supported driver from the bunch\r\n        const SupportedDrivers = drivers.filter(d => d.isSupported);\r\n        if (SupportedDrivers.length > 0) {\r\n          this.currentDriver = new SupportedDrivers[0](this);\r\n        } else {\r\n          throw new TypeError('No supported driver provided. Using fallback.');\r\n        }\r\n      } else if (drivers instanceof MultiDriver) {\r\n        this.currentDriver = drivers;\r\n      } else {\r\n        throw new TypeError('No supported driver provided. Using fallback.');\r\n      }\r\n\r\n      this.$log(`Using driver \"${this.currentDriver.constructor.name}\"`);\r\n    } catch (e) {\r\n      this.$error(e.message, true);\r\n\r\n      this.currentDriver = new FallbackDriver(this);\r\n    }\r\n\r\n    let reProxy;\r\n\r\n    if (!Proxy) {\r\n      this.$warn(`window.Proxy is unavailable. Using insufficient property forwarding.`);\r\n\r\n      reProxy = (repoName: string) => Object.defineProperty(this, repoName, {\r\n        get: () => this.repositories[repoName],\r\n      });\r\n    }\r\n\r\n    for (const repoName in repositories) {\r\n      const name: string = repoName;\r\n      const entityConstructor = repositories[name];\r\n\r\n      this.repositories[name] = makeRepository(name, {\r\n        name: this.name,\r\n        apiMap: this.apiMap && this.apiMap[name] as any,\r\n        currentDriver: this.currentDriver,\r\n      }, entityConstructor);\r\n\r\n      reProxy && reProxy(name);\r\n    }\r\n\r\n    if (Proxy) {\r\n      this.$log(`window.Proxy is available. Using modern property forwarding.`);\r\n\r\n      return new Proxy(this, {\r\n        get(target, key: string) {\r\n          if (!target.repositories[key]) {\r\n            if (!target[key]) {\r\n              target.$log(\r\n                `Repository \"${key}\" is not registered upon initialization. No other property with the same name was found.`\r\n              );\r\n            }\r\n\r\n            return target[key];\r\n          }\r\n\r\n          return target.repositories[key];\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  //#region Debug\r\n\r\n  /**\r\n   * Returns a truthy value if debug is currently enabled\r\n   *\r\n   * Returns a falsy value if debug is currently disabled\r\n   */\r\n  public static $debug(): DebugState;\r\n  /**\r\n   * Enable or disable all debug logs\r\n   */\r\n  public static $debug(enabled: boolean): void;\r\n  /**\r\n   * Enable or disable all debug logs.\r\n   *\r\n   * Allows specifying different debug types:\r\n   *\r\n   * - `soft` - informative, only logs to console\r\n   * - `hard` - throws exceptions, forcing proper error-handling\r\n   */\r\n  public static $debug(enabled: boolean, exceptions: ExceptionType): void;\r\n  /**\r\n   * Enable a certain debug option for WEBALORM\r\n   */\r\n  public static $debug(type: DebugType): void;\r\n  /**\r\n   * Enable a certain debug option for WEBALORM\r\n   *\r\n   * Allows specifying different debug types:\r\n   *\r\n   * - `soft` - informative, only logs to console\r\n   * - `hard` - throws exceptions, forcing proper error-handling\r\n   */\r\n  public static $debug(type: DebugType, exceptions: ExceptionType): void;\r\n  /**\r\n   * Enable a certain debug option for WEBALORM\r\n   */\r\n  public static $debug(type: string): void;\r\n  /**\r\n   * Enable a certain debug option for WEBALORM\r\n   *\r\n   * Allows specifying different debug types:\r\n   *\r\n   * - `soft` - informative, only logs to console\r\n   * - `hard` - throws exceptions, forcing proper error-handling\r\n   */\r\n  public static $debug(type: string, exceptions: ExceptionType): void;\r\n  public static $debug(type?: boolean | string, exceptions?: ExceptionType) {\r\n    if (typeof type === 'undefined') {\r\n      return debugState;\r\n    }\r\n\r\n    if (typeof type === 'boolean') {\r\n      setDebugState(type ? 'enabled' : 'disabled');\r\n      debugMap['*'] = exceptions || type;\r\n    } else {\r\n      setDebugState('custom');\r\n\r\n      debugMap[type] = exceptions || !debugMap[type];\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  //#endregion\r\n}\r\n","import { ApiMap } from '../apiMap';\r\nimport { IDriverConstructor } from '../drivers';\r\nimport { Connection as connection, IRepositoryMap, RepoStore } from './connection';\r\n\r\nexport const Connection = connection as {\r\n  /**\r\n   * Creates a WEBALORM connection instance.\r\n   * @param name the name of the connection to the storage. Namespaces all respositories invoked from the instance.\r\n   * @param drivers determine a variety of drivers the orm can select from. The first one that fits for the environment is selected.\r\n   * @param repositories sets the relation of a repository name to its contents' prototype.\r\n   * @param apiMap maps the API calls onto the current data structure.\r\n   */\r\n  new <\r\n    RM extends IRepositoryMap = IRepositoryMap,\r\n    AM extends ApiMap<RM> = ApiMap<RM>\r\n  >(\r\n      name: string,\r\n      drivers: IDriverConstructor[],\r\n      repositories: RM,\r\n      apiMap?: AM\r\n  ): connection<RM, AM> & RepoStore<RM, AM>;\r\n} & typeof connection;\r\n\r\nexport type Connection<\r\n  RM extends IRepositoryMap = any,\r\n  AM extends ApiMap<RM> = any\r\n> = connection<RM, AM>;\r\n\r\nexport * from './namespace';\r\n\r\n","import { DebugType, LogLevel, print } from '../debug';\r\n\r\ntype MessageFactory = ((this: any, ...args: any[]) => string)\r\n  | ((key: PropertyKey, value: any, newValue?: any) => string)\r\n  | string;\r\n\r\n/**\r\n *\r\n *\r\n * @param message\r\n * A factory for log messages.\r\n * Can be one of 3 types:\r\n * 1. A function that returns a string - has the same context as the decorated property\r\n * 2. A string - any string you'd like to print\r\n *\r\n * A function accepts 2 types of arguments:\r\n * - If the `prints` decorator is applied to a function - accepts arguments of the function call;\r\n * - If applied to a property - accepts key and value of the property if the property is being read and a new value if a property is being set;\r\n *\r\n * @param [level] a log level to print to. Can be one of 'log', 'warn', 'error' or 'debug'\r\n * @param [type] the log type. See {@link LogLevel} for more details\r\n */\r\nexport function prints(message: MessageFactory, level?: LogLevel, type?: string);\r\nexport function prints(message: MessageFactory, level?: LogLevel, type?: DebugType);\r\nexport function prints(message: MessageFactory, level?: LogLevel, type?: RegExp);\r\nexport function prints(messageHandler: any, level: LogLevel = 'log', type: any = '*', force: boolean = false) {\r\n  return (target, key: PropertyKey, desc: PropertyDescriptor) => {\r\n    const _print = function (this: any) {\r\n      const p = _ => {\r\n        let context: string = '';\r\n\r\n        if (target.constructor && target.constructor.name) {\r\n          context = `${target.constructor.name}:${String(key)}`;\r\n        } else if (target.name) {\r\n          context = `${target.name}:${String(key)}`;\r\n        } else if (this.name) {\r\n          context = `${this.name}:${String(key)}`;\r\n        }\r\n\r\n        print(context, type, _, level, force);\r\n      };\r\n\r\n      if (typeof messageHandler === 'function') {\r\n        p(messageHandler.apply(this, arguments));\r\n      } else {\r\n        p(messageHandler);\r\n      }\r\n    };\r\n\r\n    const assignDescValue = (d: PropertyDescriptor) => {\r\n      let original = d.value;\r\n\r\n      d.get = function () {\r\n        _print.apply(this, [key, original]);\r\n\r\n        return original;\r\n      };\r\n\r\n      d.set = function (v) {\r\n        _print.apply(this, [key, original, v]);\r\n\r\n        original = v;\r\n      };\r\n    };\r\n\r\n    if (desc) {\r\n      if (typeof desc.value === 'function') {\r\n        let original = desc.value;\r\n\r\n        desc.value = function () {\r\n          _print.apply(this, arguments);\r\n\r\n          return original.apply(this, arguments);\r\n        };\r\n      } else if (typeof desc.value !== 'undefined' || desc.set) {\r\n        assignDescValue(desc);\r\n      }\r\n    } else {\r\n      const d: PropertyDescriptor = {};\r\n\r\n      if (d.get) {\r\n        const original = d.get;\r\n\r\n        d.get = function (this: any) {\r\n          _print.apply(this);\r\n\r\n          return original.apply(this);\r\n        };\r\n      } else {\r\n        assignDescValue(d);\r\n      }\r\n\r\n      Reflect.deleteProperty(target, key);\r\n      Reflect.defineProperty(target, key, d);\r\n    }\r\n  };\r\n}\r\n"],"names":["tslib_1.__decorate","tslib_1.__extends","Connection","connection"],"mappings":"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"}