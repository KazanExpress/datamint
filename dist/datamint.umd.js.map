{"version":3,"file":"datamint.umd.js","sources":["../src/decorators/index.ts","../src/debug/module.ts","../src/debug/debugable.ts","../src/debug/index.ts","../src/connection/connection.ts","../src/connection/index.ts","../src/drivers/base.ts","../src/drivers/fallback.ts","../src/drivers/multiDriver.ts","../src/repository/base.ts","../src/queryResult.ts","../src/storable/base.ts","../src/storable/entity.ts","../src/repository/record.ts","../src/storable/record.ts","../src/repository/entity.ts","../src/repository/remote.ts"],"sourcesContent":["export const enumerable = (isEnumerable: boolean = true) => function (target: object, key: string, desc?: any) {\r\n  let descriptor = Object.getOwnPropertyDescriptor(target, key) || desc || {};\r\n  if (descriptor.enumerable != isEnumerable) {\r\n    descriptor.enumerable = !!isEnumerable;\r\n    if (descriptor.get || descriptor.set) {\r\n      descriptor.configurable = descriptor.configurable === undefined ? true : descriptor.configurable;\r\n    } else {\r\n      descriptor.writable = descriptor.writable === undefined ? true : descriptor.writable;\r\n    }\r\n    Reflect.deleteProperty(target, key);\r\n    Object.defineProperty(target, key, descriptor);\r\n  }\r\n};\r\n","const LOG_PREFIX = (name: string) => name ? `[datamint:${name}]` : `[datamint]`;\r\n\r\n/**\r\n * A type of debug errors\r\n *\r\n * - `soft` - informative, only logs to console\r\n * - `hard` - throws exceptions, forcing proper error-handling\r\n */\r\nexport type ExceptionType = 'soft' | 'hard';\r\n\r\n/**\r\n * Dictates the type of debug to set\r\n *\r\n * - `*` - debug everything\r\n * - `connection` - debug the orm connection\r\n * - `driver` - debug all drivers\r\n * - `driver:${name}` - debug a driver with ${name}\r\n * - `db` - debug all repositories\r\n * - `db:${name}` - debug a repo with ${name}\r\n * - `db:${name}:entity` - debug all entities in the repository\r\n */\r\nexport type DebugType = '*'\r\n  | 'connection'\r\n  | 'driver'\r\n  // tslint:disable-next-line:no-invalid-template-strings - Need this for correct autocomplete\r\n  | 'driver:${name}'\r\n  | 'db'\r\n  // tslint:disable-next-line:no-invalid-template-strings - Need this for correct autocomplete\r\n  | 'db:${name}'\r\n  // tslint:disable-next-line:no-invalid-template-strings - Need this for correct autocomplete\r\n  | 'db:${name}:entity';\r\n\r\nexport type DebugState = 'enabled' | 'disabled' | 'custom';\r\n\r\n/**\r\n * Maps all debug types to all errors types, telling which debug type will throw\r\n */\r\nexport type DebugMap = Partial<{\r\n  [key: string]: boolean | ExceptionType;\r\n}>;\r\n\r\nexport type LogLevel = 'log' | 'debug' | 'warn' | 'error';\r\n\r\n\r\n/**\r\n * Shows the current debug state of DATAMINT\r\n *\r\n * - `enabled` - all the logs and exceptions are enabled\r\n * - `custom` - custom rules are set via a `debug()` function\r\n * - `disabled` - all the logs and most exceptions are suppressed\r\n */\r\nexport let debugState: DebugState = 'disabled';\r\n\r\n\r\n/**\r\n * Contains the map for all debug types and their respective error types for the ORM.\r\n */\r\nexport const debugMap: DebugMap = {};\r\n\r\nexport function setDebugState(state: DebugState) {\r\n  debugState = state;\r\n}\r\n\r\n\r\n\r\n/**\r\n * Returns the current error type for a specific type of debugging\r\n */\r\nexport function errorTypeFor(type: string): boolean | ExceptionType;\r\nexport function errorTypeFor(type: RegExp): boolean | ExceptionType;\r\nexport function errorTypeFor(type: DebugType): boolean | ExceptionType;\r\nexport function errorTypeFor(type: string | RegExp | DebugType): boolean | ExceptionType {\r\n  if (debugMap['*']) { return debugMap['*']!; }\r\n\r\n  const isString = (t: any): t is string => typeof t === 'string';\r\n\r\n  if (isString(type) && debugMap[type]) {\r\n    return debugMap[type]!;\r\n  }\r\n\r\n  if (isString(type)) {\r\n    const matchingType = Object.keys(debugMap)\r\n      .find(t => !!t && t.includes(type) && !!debugMap[t]) as ExceptionType | undefined;\r\n\r\n    return matchingType || false;\r\n  }\r\n\r\n  return (Object.keys(debugMap).find(t => type.test(t)) as ExceptionType | undefined) || false;\r\n}\r\n\r\n\r\nexport function print(instanceName: string, type: any, message: any, level: LogLevel, force: boolean = false) {\r\n  if ((debugState !== 'disabled') || force) {\r\n    const errorType = errorTypeFor(type);\r\n    if (errorType) {\r\n      if (errorType === 'hard' && level === 'error') {\r\n        throw new Error(`${LOG_PREFIX(instanceName)}:${type} - ${message}`);\r\n      } else {\r\n        if (typeof window !== 'undefined') {\r\n          window.console[level](`%c${LOG_PREFIX(instanceName)}%c:%c${type}%c - ${message}`,\r\n            'color: purple',\r\n            'color: initial',\r\n            'color: blue',\r\n            'color: initial'\r\n          );\r\n        } else {\r\n          console[level](`${LOG_PREFIX(instanceName)}:${type} - ${message}`);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { enumerable } from '../decorators';\r\nimport { DebugType, errorTypeFor, LogLevel, print } from './module';\r\n\r\nexport abstract class Debugable {\r\n  /**\r\n   * The debug type for this class' actions\r\n   */\r\n  @enumerable(false)\r\n  protected readonly abstract debugType: DebugType;\r\n\r\n  /**\r\n   * The name of the DATAMINT connection this class uses\r\n   */\r\n  @enumerable(false)\r\n  public readonly abstract connectionName: string;\r\n\r\n  /**\r\n   * `true` if the debug is enabled for this class\r\n   */\r\n  @enumerable(false)\r\n  public get isDebugEnabled() { return errorTypeFor(this.debugType); }\r\n\r\n  @enumerable(false)\r\n  private $logFactory(level: LogLevel) {\r\n    return (message: any, force: boolean = false) =>\r\n      print(this.connectionName, this.debugType, message, level, force);\r\n  }\r\n\r\n  @enumerable(false)\r\n  protected readonly $log = this.$logFactory('log');\r\n  @enumerable(false)\r\n  protected readonly $warn = this.$logFactory('warn');\r\n  @enumerable(false)\r\n  protected readonly $error = this.$logFactory('error');\r\n  @enumerable(false)\r\n  protected readonly $debug = this.$logFactory('debug');\r\n}\r\n\r\nexport class DebugInstance extends Debugable {\r\n  constructor(\r\n    protected readonly debugType: DebugType,\r\n    public readonly connectionName: string\r\n  ) { super(); }\r\n\r\n  public $log!: Debugable['$log'];\r\n  public $warn!: Debugable['$warn'];\r\n  public $error!: Debugable['$error'];\r\n  public $debug!: Debugable['$debug'];\r\n}\r\n","import { Debugable } from './debugable';\r\nimport { debugMap, debugState, DebugType } from './module';\r\n\r\nclass GlobalDebug extends Debugable {\r\n  protected readonly debugType: DebugType = '*';\r\n  public readonly connectionName: string = '';\r\n  private constructor() { super(); }\r\n\r\n  public static readonly instance = new GlobalDebug();\r\n\r\n  public $log!: Debugable['$log'];\r\n  public $warn!: Debugable['$warn'];\r\n  public $error!: Debugable['$error'];\r\n  public $debug!: Debugable['$debug'];\r\n\r\n  public get map() {\r\n    return debugMap;\r\n  }\r\n\r\n  public get state() {\r\n    return debugState;\r\n  }\r\n}\r\n\r\nexport const Debug = GlobalDebug.instance;\r\n\r\nexport * from './debugable';\r\nexport * from './module';\r\n\r\n","import { Debugable, debugMap, DebugState, debugState, DebugType, ExceptionType, setDebugState } from '../debug';\r\nimport { DataMap, RepoFactory, Repository } from '../repository/base';\r\n\r\nexport interface IRepositoryMap {\r\n  [name: string]: RepoFactory<any>;\r\n}\r\n\r\nexport type RepoStore<M extends IRepositoryMap> = {\r\n  [Name in keyof M]: ReturnType<M[Name]>;\r\n};\r\n\r\nexport class Connection<\r\n  RM extends IRepositoryMap = IRepositoryMap,\r\n> extends Debugable {\r\n  protected debugType: DebugType = `connection`;\r\n\r\n  /**\r\n   * A current map of bound repositories\r\n   */\r\n  public readonly repositories: RepoStore<RM> = {} as any;\r\n\r\n  [key: string]: any;\r\n\r\n  /**\r\n   * Creates a connection instance.\r\n   * @param name the name of the connection to the storage. Namespaces all respositories invoked from the instance.\r\n   * @param repositories sets the relation of a repository name to its contents' options.\r\n   */\r\n  constructor(\r\n    public readonly connectionName: string,\r\n    repositories: RM,\r\n  ) {\r\n    super();\r\n\r\n    let reProxy;\r\n\r\n    if (!Proxy) {\r\n      this.$warn(`Proxy is unavailable. Using insufficient property forwarding.`);\r\n\r\n      reProxy = (repoName: string) => Object.defineProperty(this, repoName, {\r\n        get: () => this.repositories[repoName],\r\n      });\r\n    }\r\n\r\n    for (const repoName in repositories) {\r\n      this.repositories[repoName] = repositories[repoName](repoName, this);\r\n\r\n      reProxy && reProxy(repoName);\r\n    }\r\n\r\n    // Make repositories immutable\r\n    this.repositories = Object.freeze(this.repositories);\r\n\r\n    if (Proxy) {\r\n      this.$log(`Proxy is available. Using modern property forwarding.`);\r\n\r\n      return new Proxy(this, {\r\n        get(target, key: string) {\r\n          if (!target.repositories[key]) {\r\n            if (typeof target[key] === 'undefined') {\r\n              target.$warn(\r\n                `Repository \"${key}\" is not registered upon initialization. No other property with the same name was found.`\r\n              );\r\n            }\r\n\r\n            return target[key];\r\n          }\r\n\r\n          return target.repositories[key];\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  //#region Debug\r\n\r\n  /**\r\n   * Returns a truthy value if debug is currently enabled\r\n   *\r\n   * Returns a falsy value if debug is currently disabled\r\n   */\r\n  public static $debug(): DebugState;\r\n  /**\r\n   * Enable or disable all debug logs\r\n   */\r\n  public static $debug(enabled: boolean): void;\r\n  /**\r\n   * Enable or disable all debug logs.\r\n   *\r\n   * Allows specifying different debug types:\r\n   *\r\n   * - `soft` - informative, only logs to console\r\n   * - `hard` - throws exceptions, forcing proper error-handling\r\n   */\r\n  public static $debug(enabled: boolean, exceptions: ExceptionType): void;\r\n  /**\r\n   * Enable a certain debug option for DATAMINT\r\n   */\r\n  public static $debug(type: DebugType): void;\r\n  /**\r\n   * Enable a certain debug option for DATAMINT\r\n   *\r\n   * Allows specifying different debug types:\r\n   *\r\n   * - `soft` - informative, only logs to console\r\n   * - `hard` - throws exceptions, forcing proper error-handling\r\n   */\r\n  public static $debug(type: DebugType, exceptions: ExceptionType): void;\r\n  /**\r\n   * Enable a certain debug option for DATAMINT\r\n   */\r\n  public static $debug(type: string): void;\r\n  /**\r\n   * Enable a certain debug option for DATAMINT\r\n   *\r\n   * Allows specifying different debug types:\r\n   *\r\n   * - `soft` - informative, only logs to console\r\n   * - `hard` - throws exceptions, forcing proper error-handling\r\n   */\r\n  public static $debug(type: string, exceptions: ExceptionType): void;\r\n  public static $debug(type?: boolean | string, exceptions?: ExceptionType) {\r\n    if (typeof type === 'undefined') {\r\n      return debugState;\r\n    }\r\n\r\n    if (typeof type === 'boolean') {\r\n      setDebugState(type ? 'enabled' : 'disabled');\r\n      debugMap['*'] = exceptions || type;\r\n    } else {\r\n      setDebugState('custom');\r\n\r\n      debugMap[type] = exceptions || !debugMap[type];\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  //#endregion\r\n}\r\n","import { Connection as connection, IRepositoryMap, RepoStore } from './connection';\r\n\r\nexport const Connection = connection as {\r\n  /**\r\n   * Creates a connection instance.\r\n   * @param name the name of the connection to the storage. Namespaces all respositories invoked from the instance.\r\n   * @param repositories sets the relation of a repository name to its contents' prototype.\r\n   */\r\n  new <\r\n    RM extends IRepositoryMap = IRepositoryMap\r\n  >(\r\n      name: string,\r\n      repositories: RM,\r\n  ): connection<RM> & RepoStore<RM>;\r\n} & typeof connection;\r\n\r\nexport type Connection<\r\n  RM extends IRepositoryMap = any\r\n> = connection<RM>;\r\n\r\n","import { Connection } from '../connection';\r\nimport { Debugable, DebugType } from '../debug';\r\nimport { IRepoData } from '../repository';\r\n\r\nexport interface IDriverConstructor extends Function {\r\n  new (connection: Connection): Driver;\r\n\r\n  readonly isSupported: boolean;\r\n}\r\n\r\nexport abstract class Driver extends Debugable {\r\n  protected readonly debugType: DebugType = 'driver';\r\n  public readonly connectionName: string = this.connection.name;\r\n\r\n  constructor(\r\n    protected connection: Connection\r\n  ) { super(); }\r\n\r\n  /* TODO: additional driver functionality?.. */\r\n\r\n\r\n  public abstract create<A extends object, R extends IRepoData>(\r\n    repository: R,\r\n    data: A\r\n  ): Promise<A>;\r\n\r\n  public abstract findById<A extends object, R extends IRepoData, ID extends PropertyKey>(\r\n    repository: R,\r\n    id: ID\r\n  ): Promise<A | undefined>;\r\n\r\n  public abstract update<A extends object, R extends IRepoData>(\r\n    repository: R,\r\n    data: Partial<A>\r\n  ): Promise<Array<A>>;\r\n\r\n  public abstract updateOne<A extends object, R extends IRepoData, ID extends PropertyKey>(\r\n    repository: R,\r\n    id: ID,\r\n    query: ((entity: A) => Partial<A>) | Partial<A>\r\n  ): Promise<A | undefined>;\r\n\r\n  public abstract delete<A extends object, R extends IRepoData>(\r\n    repository: R,\r\n    data: Partial<A>\r\n  ): Promise<Array<A>>;\r\n\r\n  public abstract deleteOne<A extends object, R extends IRepoData, ID extends PropertyKey>(\r\n    repository: R,\r\n    id: ID\r\n  ): Promise<A | undefined>;\r\n\r\n  /**\r\n   * Determines if the driver is supported in current environment\r\n   */\r\n  static get isSupported(): boolean {\r\n    throw new Error('Not implemented.');\r\n  }\r\n}\r\n","import { IRepoData } from '../repository';\r\nimport { Driver } from './base';\r\n\r\n/**\r\n * @todo refactor, code is a mess\r\n */\r\nexport class FallbackDriver extends Driver {\r\n  public async create<A, R extends IRepoData>({ primaryKey, name }: R, data: A): Promise<A> {\r\n    if (!this.repositoryMap[name]) {\r\n      if ({ primaryKey, name }.primaryKey) {\r\n        this.repositoryMap[name] = {};\r\n      } else {\r\n        this.repositoryMap[name] = [];\r\n      }\r\n    }\r\n\r\n    const repo: Array<A> | { [key: string]: A } = this.repositoryMap[name];\r\n\r\n    if (primaryKey && !Array.isArray(repo)) {\r\n      const key = String(data[primaryKey]);\r\n\r\n      repo[key] = data;\r\n    } else if (Array.isArray(repo)) {\r\n      repo.push(data);\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  public async findById<A, R extends IRepoData>({ primaryKey, name }: R, id: PropertyKey) {\r\n    const repo: Array<A> | { [key: string]: A } = this.repositoryMap[name];\r\n\r\n    if (primaryKey) {\r\n      if (Array.isArray(repo)) {\r\n        return repo.find(i => i[primaryKey] === id);\r\n      } else {\r\n        if (primaryKey) {\r\n          let result: A | undefined = repo[String(id)];\r\n\r\n          if (!result) {\r\n            result = Object.values(repo).find(i => i[primaryKey] === id);\r\n          }\r\n\r\n          return result;\r\n        } else if (id) {\r\n          return repo[String(id)];\r\n        }\r\n      }\r\n    } else if (Array.isArray(repo)) {\r\n      return repo[id];\r\n    }\r\n\r\n    return Object.values(repo)[0];\r\n  }\r\n\r\n  public async update<A, R extends IRepoData>(\r\n    { name }: R,\r\n    data: Partial<A>\r\n  ): Promise<Array<A>> {\r\n    throw new Error('Method not implemented.');\r\n\r\n    return [] as Array<A>;\r\n  }\r\n\r\n  public async updateOne<A extends object, R extends IRepoData>(\r\n    { name, primaryKey }: R,\r\n    id: PropertyKey,\r\n    query: ((entity: A) => Partial<A>) | Partial<A>\r\n  ): Promise<A | undefined> {\r\n    const repo = this.repositoryMap[name];\r\n\r\n    let res: A | undefined = undefined;\r\n\r\n    const mixInQuery = (obj: A): A => typeof query === 'function' ? (\r\n        { ...obj as object, ...query(obj) as object } as A\r\n      ) : (\r\n        { ...obj as object, ...query as object } as A\r\n      );\r\n\r\n    if (primaryKey) {\r\n      if (Array.isArray(repo)) {\r\n        const idx = repo.findIndex(i => i[primaryKey] === id);\r\n\r\n        if (idx === -1) {\r\n          this.$error(`No entity by id ${String(id)} was found`);\r\n\r\n          return res;\r\n        }\r\n\r\n        repo[idx] = res = mixInQuery(repo[idx]);\r\n      } else {\r\n        repo[id] = res = mixInQuery(repo[id]);\r\n      }\r\n    } else if (Array.isArray(repo) && typeof id === 'number') {\r\n      repo[id] = res = mixInQuery(repo[id]);\r\n    } else {\r\n      this.$error(`Id ${String(id)} is of the wrong type ${typeof id}`);\r\n    }\r\n\r\n    return res;\r\n  }\r\n\r\n  public async deleteOne<A, R extends IRepoData>({ name, primaryKey }: R, id: PropertyKey): Promise<A | undefined> {\r\n    const repo = this.repositoryMap[name];\r\n\r\n    let res: A;\r\n\r\n    if (primaryKey) {\r\n      if (Array.isArray(repo)) {\r\n        const idx = repo.findIndex(i => i[primaryKey] === id);\r\n\r\n        res = repo[idx];\r\n\r\n        repo.splice(idx, 1);\r\n      } else {\r\n        res = repo[id];\r\n\r\n        repo[id] = undefined;\r\n        delete repo[id];\r\n      }\r\n    } else if (Array.isArray(repo) && typeof id === 'number') {\r\n      res = repo[id];\r\n\r\n      repo.splice(id, 1);\r\n    } else {\r\n      throw new Error(`Id ${String(id)} is of the wrong type ${typeof id}`);\r\n    }\r\n\r\n    return res;\r\n  }\r\n\r\n  public async delete<A, R extends IRepoData>({ name, primaryKey }: R, entity: Partial<A>): Promise<Array<A>> {\r\n    const repo = this.repositoryMap[name];\r\n\r\n    let res;\r\n\r\n    // if (isEntityRepo(repository)) {\r\n    //   const key = Object.keys(repo).findIndex(e => Object.keys(repo[e]).some(key => {\r\n    //     return e[key] === entity[key];\r\n    //   }));\r\n\r\n    //   res = this.repositoryMap[repository.name][key];\r\n\r\n    //   this.repositoryMap[repository.name][key] = undefined;\r\n\r\n    //   delete this.repositoryMap[repository.name][key];\r\n    // } else {\r\n    //   res = this.repositoryMap[repository.name];\r\n\r\n    //   this.repositoryMap[repository.name] = undefined;\r\n    // }\r\n\r\n    return res;\r\n  }\r\n\r\n  private repositoryMap: any = {};\r\n}\r\n","import { Connection } from '../connection';\r\nimport { IRepoData } from '../repository';\r\nimport { Driver, IDriverConstructor } from './base';\r\n\r\nexport class MultiDriver extends Driver {\r\n  private drivers: Driver[];\r\n\r\n  constructor(\r\n    connection: Connection,\r\n    drivers: IDriverConstructor[]\r\n  ) {\r\n    super(connection);\r\n\r\n    this.drivers = drivers.filter(d => d.isSupported).map(D => new D(connection));\r\n  }\r\n\r\n  private request(\r\n    type: { [key in keyof Driver]: Driver[key] extends Function ? key : never }[keyof Driver]\r\n  ) {\r\n    return function (this: MultiDriver) {\r\n      const args = arguments;\r\n      const allResponses = Promise.all(this.drivers.map(d => d[type].apply(d, args)));\r\n\r\n      return allResponses[0];\r\n    }.bind(this);\r\n  }\r\n\r\n  public readonly create: {\r\n    <A, R extends IRepoData = IRepoData>(repository: R, data: A): Promise<A>;\r\n  } = this.request('create');\r\n\r\n  public readonly findById: {\r\n    <A, R extends IRepoData = IRepoData>(repository: R, id: any): Promise<A>;\r\n  } = this.request('findById');\r\n\r\n  public readonly update: {\r\n    <A, R extends IRepoData = IRepoData>(repository: R, data: Partial<A>): Promise<Array<A>>;\r\n  } = this.request('update');\r\n\r\n  public readonly updateOne: {\r\n    <A, R extends IRepoData = IRepoData>(repository: R, id: any, query: (data: A) => Partial<A>): Promise<A | undefined>;\r\n  } = this.request('updateOne');\r\n\r\n  public readonly deleteOne: {\r\n    <A, R extends IRepoData = IRepoData>(repository: R, id: any): Promise<A>;\r\n  } = this.request('deleteOne');\r\n\r\n  public readonly delete: {\r\n    <A, R extends IRepoData = IRepoData>(repository: R, data: Partial<A>): Promise<Array<A>>;\r\n  } = this.request('delete');\r\n\r\n  public static get isSupported() { return true; }\r\n}\r\n","import { Connection } from '../connection';\r\nimport { Debug, Debugable, DebugType } from '../debug';\r\nimport { FallbackDriver, IDriverConstructor } from '../drivers';\r\nimport { MultiDriver } from '../drivers/multiDriver';\r\nimport { IStorableConstructor, Storable } from '../storable';\r\n\r\nexport interface IRepoData {\r\n  readonly name: string;\r\n  readonly connectionName: string;\r\n  readonly columns: Array<string>;\r\n  readonly primaryKey?: PropertyKey | undefined;\r\n}\r\n\r\nexport type FromSecArg<\r\n  T extends undefined | ((arg: any, other: any) => any)\r\n> = T extends ((arg: any, other: infer U) => any) ? U : undefined;\r\n\r\nexport type DataMap<C extends IStorableConstructor<any>, Keys extends string = string> = {\r\n  [key in Keys]: ((...args: any[]) => Promise<InstanceType<C>>) | undefined;\r\n};\r\n\r\nexport abstract class Repository<\r\n  DM,\r\n  C extends IStorableConstructor<E>,\r\n  E extends Storable = InstanceType<C>,\r\n  A extends ConstructorParameters<C>[0] = ConstructorParameters<C>[0],\r\n> extends Debugable implements IRepoData {\r\n  public readonly columns: Array<string> = [];\r\n\r\n  protected readonly debugType: DebugType = `db:${this.name.toLowerCase()}` as DebugType;\r\n\r\n  constructor(\r\n    public readonly name: string,\r\n    public readonly connectionName: string,\r\n    private readonly Data: C,\r\n    protected readonly api?: DM,\r\n  ) {\r\n    super();\r\n\r\n    if (!api) {\r\n      this.$warn('The main functionality is disabled. Are you sure you want to use this without API?', true);\r\n    }\r\n\r\n    if (/* this class was instantiated directly (without inheritance) */\r\n      Repository.prototype === this.constructor.prototype\r\n    ) {\r\n      if (this.isDebugEnabled) {\r\n        this.$error(`Using default empty repository.`);\r\n      } else {\r\n        Debug.$error(`Using default empty repository for ${name}`, true);\r\n      }\r\n    }\r\n\r\n\r\n    if (Data.prototype.__col__) {\r\n      this.columns = Data.prototype.__col__.slice();\r\n\r\n      delete Data.prototype.__col__;\r\n    } else {\r\n      this.columns = Object.keys(new Data({}, this));\r\n    }\r\n  }\r\n\r\n  protected makeDataInstance(options: A): E {\r\n    return new this.Data(options, this);\r\n  }\r\n}\r\n\r\nexport interface IRepoFactoryOptions<C, D> {\r\n  model: C;\r\n  api: D;\r\n}\r\n\r\nexport type RepoFactory<Repo extends Repository<any, any> = Repository<any, any>> = (name: string, connection: Connection) => Repo;\r\n\r\nexport function selectDriver(drivers: IDriverConstructor | IDriverConstructor[], repoName: string): IDriverConstructor {\r\n  const error = () => {\r\n    let msg: string = `No supported driver provided for ${repoName}.`;\r\n\r\n    if (Debug.map['*'] !== 'hard') {\r\n      msg += ' Using fallback.';\r\n    }\r\n\r\n    Debug.$error(msg);\r\n  };\r\n\r\n  if (Array.isArray(drivers)) {\r\n    // Select the first supported driver from the bunch\r\n    const SupportedDrivers = drivers.filter(d => d.isSupported);\r\n    if (SupportedDrivers.length > 0) {\r\n      return SupportedDrivers[0];\r\n    } else {\r\n      return error(), FallbackDriver;\r\n    }\r\n  } else if (drivers instanceof MultiDriver) {\r\n    return drivers;\r\n  } else {\r\n    return error(), FallbackDriver;\r\n  }\r\n}\r\n","import { enumerable } from './decorators';\r\n\r\n/**\r\n * Incapsulates the query result data for further manipulation\r\n *\r\n * @template T the type of data encapsulated\r\n */\r\nexport class QueryResult<T> {\r\n  @enumerable(false)\r\n  private _ok: boolean;\r\n  @enumerable(false)\r\n  private _result: T;\r\n  @enumerable(false)\r\n  private _error?: Error;\r\n  @enumerable(false)\r\n  private handlers: ((error?: Error, result?: T) => any)[] = [];\r\n\r\n  constructor(ok: boolean, result: T, error?: Error) {\r\n    this._ok = ok;\r\n    this._result = result;\r\n    this._error = error;\r\n  }\r\n\r\n  /**\r\n   * Determines whether the incapsulated data is OK and contains no errors\r\n   */\r\n  public get ok() { return this._ok; }\r\n\r\n  /**\r\n   * The resulting data of the query request\r\n   */\r\n  public get result() { return this._result; }\r\n  public set result(value) {\r\n    this._ok = true;\r\n    this._result = value;\r\n    this.handlers.forEach(h => h(this.error, this.result));\r\n  }\r\n\r\n  /**\r\n   * The error of the query (if any)\r\n   */\r\n  public get error() { return this._error; }\r\n  public set error(value) {\r\n    this._ok = false;\r\n    this._error = value;\r\n    this.handlers.forEach(h => h(this.error, this.result));\r\n  }\r\n\r\n  /**\r\n   * Fires a handler whenever the data in the result has been changed\r\n   *\r\n   * @param callback the callback to fire\r\n   */\r\n  public onChange(callback: (error?: Error, result?: T) => any) {\r\n    this.handlers.push(callback);\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe the callback from the result data changes\r\n   */\r\n  public offChange(callback: (error?: Error, result?: T) => any) {\r\n    const idx = this.handlers.indexOf(callback);\r\n\r\n    if (idx > -1) {\r\n      this.handlers.splice(idx, 1);\r\n    }\r\n  }\r\n}\r\n","import { enumerable } from '../decorators';\r\n\r\nexport type IStorableConstructor<E extends Storable> = new (options: any, ...args: any[]) => E;\r\n\r\nexport abstract class Storable {\r\n  @enumerable(false)\r\n  private __col__: Array<PropertyKey> = [];\r\n\r\n  @enumerable(false)\r\n  protected __options: any;\r\n\r\n  constructor(__options: any, ..._: any[]) {\r\n    this.__options = __options;\r\n  }\r\n\r\n  public static Property(target: Storable, key: PropertyKey) {\r\n    if (!target.__col__) {\r\n      target.__col__ = [];\r\n    }\r\n\r\n    target.__col__.push(key);\r\n  }\r\n}\r\n\r\nexport interface IActiveRecord {\r\n  $save(): Promise<this | undefined>;\r\n  $delete(): Promise<this | undefined>;\r\n}\r\n","import { DebugInstance, DebugType } from '../debug';\r\nimport { enumerable } from '../decorators';\r\nimport { QueryResult } from '../queryResult';\r\nimport { IEntityRepository } from '../repository/entity';\r\nimport { IActiveRecord, Storable } from './base';\r\n\r\ntype WithId<T, IDKey extends PropertyKey, IDValue> = T & {\r\n  [key in IDKey]: IDValue;\r\n};\r\n\r\nexport class Entity<\r\n  IDKey extends PropertyKey = any,\r\n  IDValue extends PropertyKey = any\r\n> extends Storable {\r\n  @enumerable(false)\r\n  protected __idKey__?: IDKey;\r\n\r\n  @enumerable(false)\r\n  protected __idValue__?: IDValue;\r\n\r\n  constructor(options: WithId<{ [key: string]: any }, IDKey, IDValue>, ...args: any[]) {\r\n    super(options, ...args);\r\n\r\n    if (this.__idKey__ && options[String(this.__idKey__)]) {\r\n      Reflect.deleteProperty(this, '__idValue__');\r\n      Reflect.defineProperty(this, '__idValue__', {\r\n        value: options[String(this.__idKey__)],\r\n        writable: true,\r\n        enumerable: false\r\n      });\r\n\r\n      Reflect.deleteProperty(this, this.__idKey__);\r\n      Reflect.defineProperty(this, this.__idKey__, {\r\n        get: () => this.__idValue__,\r\n        set: v => this.__idValue__ = v,\r\n        enumerable: true\r\n      });\r\n    }\r\n  }\r\n\r\n  public static ID(target: Entity, key: PropertyKey) {\r\n    target.__idKey__ = key;\r\n\r\n    (target.constructor as typeof Entity).Property(target, key);\r\n  }\r\n}\r\n\r\n/**\r\n * Enables ActiveRecord pattern for the entity\r\n */\r\nexport class SaveableEntity<\r\n  IDKey extends PropertyKey = string,\r\n  IDValue extends PropertyKey = any\r\n> extends Entity<IDKey, IDValue> implements IActiveRecord {\r\n  @enumerable(false)\r\n  private readonly __debug: DebugInstance;\r\n  @enumerable(false)\r\n  private readonly __repo?: IEntityRepository<any, this, any, IDKey, IDValue>;\r\n\r\n  @enumerable(false)\r\n  private __contextWarning(optional: string = '') {\r\n    this.__debug.$warn(`Seems like the entity \"${\r\n      this.constructor.name\r\n    }\" was initialized in a wrong context.\\n${optional}`, true);\r\n  }\r\n\r\n  constructor(\r\n    options: WithId<{ [key: string]: any }, IDKey, IDValue>,\r\n    repo?: IEntityRepository<any, any, any, IDKey, IDValue>\r\n  ) {\r\n    super(options, repo);\r\n\r\n    if (repo) {\r\n      this.__repo = repo;\r\n\r\n      this.__debug = new DebugInstance(\r\n        `db:${repo.name}:entity` as DebugType,\r\n        this.__repo.connectionName\r\n        );\r\n    } else {\r\n      this.__debug = new DebugInstance('*', '');\r\n      this.__contextWarning();\r\n    }\r\n  }\r\n\r\n  public $save(): Promise<this | undefined> {\r\n    if (!this.__repo) {\r\n      this.__contextWarning('Saving cannot be done.');\r\n\r\n      return Promise.resolve(undefined);\r\n    }\r\n\r\n    const idkey = this.__idKey__;\r\n\r\n    return this.__repo.updateById(\r\n      idkey ? this[idkey as PropertyKey] : 0,\r\n      () => this\r\n    ).then(r => r.result).catch(e => { throw e; });\r\n  }\r\n\r\n  public $delete(): Promise<this | undefined> {\r\n    if (!this.__repo) {\r\n      this.__contextWarning('Deletion cannot be done.');\r\n\r\n      return Promise.resolve(undefined);\r\n    }\r\n\r\n    const idkey = this.__idKey__;\r\n\r\n    return this.__repo.delete(\r\n      idkey ? this[idkey as PropertyKey] : 0\r\n    ).then(r => r.result).catch(e => { throw e; });\r\n  }\r\n}\r\n","import { Connection } from '../connection/connection';\r\nimport { Debugable } from '../debug';\r\nimport { Driver, FallbackDriver, IDriverConstructor } from '../drivers';\r\nimport { QueryResult } from '../queryResult';\r\nimport { IStorableConstructor, Record } from '../storable';\r\nimport { FromSecArg, IRepoData, IRepoFactoryOptions, RepoFactory, Repository, selectDriver } from './base';\r\n\r\nexport interface IRecordRepoMethods<\r\n  C extends IStorableConstructor<E>,\r\n  E extends Record = InstanceType<C>,\r\n  A extends ConstructorParameters<C>[0] = ConstructorParameters<C>[0],\r\n  R = any\r\n> {\r\n  create(\r\n    options: A,\r\n    apiOptions?: any\r\n  ): Promise<R>;\r\n\r\n  read(\r\n    apiOptions?: any\r\n  ): Promise<R>;\r\n\r\n  update(\r\n    options: Partial<A>,\r\n    apiOptions?: any\r\n  ): Promise<R>;\r\n\r\n  delete(\r\n    deleteApiOptions?: any\r\n  ): Promise<R>;\r\n\r\n  //...\r\n  // TODO - other methods?\r\n}\r\nexport interface IRecordRepository<\r\n  C extends IStorableConstructor<E>,\r\n  E extends Record = InstanceType<C>,\r\n  A extends ConstructorParameters<C>[0] = ConstructorParameters<C>[0]\r\n> extends IRepoData, IRecordRepoMethods<C, E, A, QueryResult<E> | QueryResult<undefined>>, Debugable {}\r\n\r\nexport type RecordDataMap<\r\n  C extends IStorableConstructor<E>,\r\n  E extends Record = InstanceType<C>,\r\n  A extends ConstructorParameters<C>[0] = ConstructorParameters<C>[0]\r\n> = Partial<IRecordRepoMethods<C, E, A, A | undefined>>;\r\n\r\n/**\r\n * A single-entity repository.\r\n *\r\n * @template `DM` API data map for the repo\r\n * @template `C` entity constructor type\r\n * @template `E` entity instance type\r\n * @template `A` entity constructor parameter options\r\n */\r\nexport class RecordRepositoryClass<\r\n  DM extends RecordDataMap<C, E, A>,\r\n  C extends IStorableConstructor<E>,\r\n  E extends Record = InstanceType<C>,\r\n  A extends ConstructorParameters<C>[0] = ConstructorParameters<C>[0],\r\n> extends Repository<DM, C, E, A> implements IRepoData, IRecordRepository<C, E ,A> {\r\n  constructor(\r\n    name: string,\r\n    connectionName: string,\r\n    public readonly currentDriver: Driver,\r\n    record: C,\r\n    api?: DM,\r\n  ) { super(name, connectionName, record, api); }\r\n\r\n  public async create(\r\n    options: A,\r\n    apiOptions?: FromSecArg<DM['create']> | false\r\n  ) {\r\n    throw new Error('Not implemented');\r\n\r\n    return new QueryResult<E>(/* TODO: implement this */\r\n      true,\r\n      this.makeDataInstance({} as any)\r\n    );\r\n  }\r\n\r\n  public async update(\r\n    options: Partial<A>,\r\n    apiOptions?: FromSecArg<DM['update']> | false\r\n  ) {\r\n    throw new Error('Not implemented');\r\n\r\n    return new QueryResult(/* TODO: implement this */\r\n      true,\r\n      this.makeDataInstance({} as any)\r\n    );\r\n  }\r\n\r\n  public async read(apiOptions?: FromSecArg<DM['read']> | false) {\r\n    throw new Error('Not implemented');\r\n\r\n    return new QueryResult(/* TODO: implement this */\r\n      true,\r\n      this.makeDataInstance({} as any)\r\n    );\r\n  }\r\n\r\n  public async delete(apiOptions?: FromSecArg<DM['delete']> | false) {\r\n    throw new Error('Not implemented');\r\n\r\n    return new QueryResult(/* TODO: implement this */\r\n      true,\r\n      this.makeDataInstance({} as any)\r\n    );\r\n  }\r\n}\r\n\r\n\r\nexport function RecordRepository<\r\n  D extends RecordDataMap<C>,\r\n  C extends IStorableConstructor<any>,\r\n  E extends Record = InstanceType<C>,\r\n  A extends ConstructorParameters<C>[0] = ConstructorParameters<C>[0],\r\n>(options: IRepoFactoryOptions<C, D> & {\r\n  dirvers?: IDriverConstructor | IDriverConstructor[];\r\n}): RepoFactory<RecordRepositoryClass<D, C, E, A>> {\r\n  return (name: string, connection: Connection) => new RecordRepositoryClass<D, C, E, A>(\r\n    name,\r\n    connection.name,\r\n    new (selectDriver(options.dirvers || FallbackDriver, name))(connection),\r\n    options.model,\r\n    options.api\r\n  );\r\n}\r\n","import { DebugInstance, DebugType } from '../debug';\r\nimport { enumerable } from '../decorators';\r\nimport { RecordRepositoryClass } from '../repository/record';\r\nimport { IActiveRecord, Storable } from './base';\r\n\r\nexport class Record extends Storable {\r\n  constructor(options: any, ...args: any[]) { super(options, ...args); }\r\n}\r\n\r\nexport class SaveableRecord extends Record implements IActiveRecord {\r\n  @enumerable(false)\r\n  private readonly __debug: DebugInstance;\r\n  @enumerable(false)\r\n  private readonly __repo?: RecordRepositoryClass<any, any, this, any>;\r\n\r\n  @enumerable(false)\r\n  private __contextWarning(optional: string = '') {\r\n    this.__debug.$warn(`Seems like the record \"${\r\n      this.constructor.name\r\n    }\" was initialized in a wrong context.\\n${optional}`, true);\r\n  }\r\n\r\n  constructor(options, repo?: RecordRepositoryClass<any, any, any, any>) {\r\n    super(options, repo);\r\n\r\n    if (repo) {\r\n      this.__repo = repo;\r\n\r\n      this.__debug = new DebugInstance(\r\n        `db:${repo.name}:entity` as DebugType,\r\n        this.__repo.connectionName\r\n        );\r\n    } else {\r\n      this.__debug = new DebugInstance('*', '');\r\n      this.__contextWarning();\r\n    }\r\n  }\r\n\r\n  public $save() {\r\n    if (!this.__repo) {\r\n      this.__contextWarning('Saving cannot be done.');\r\n\r\n      return Promise.resolve(undefined);\r\n    }\r\n\r\n    return this.__repo.update(this)\r\n      .then(r => r.result)\r\n      .catch(e => { throw e; });\r\n  }\r\n\r\n  public $delete(): Promise<this | undefined> {\r\n    if (!this.__repo) {\r\n      this.__contextWarning('Deletion cannot be done.');\r\n\r\n      return Promise.resolve(undefined);\r\n    }\r\n\r\n    return this.__repo.delete()\r\n      .then(r => r.result)\r\n      .catch(e => { throw e; });\r\n  }\r\n}\r\n","import { Connection } from '../connection/connection';\r\nimport { Debugable } from '../debug';\r\nimport { Driver, FallbackDriver, IDriverConstructor } from '../drivers';\r\nimport { QueryResult } from '../queryResult';\r\nimport { Entity, IStorableConstructor } from '../storable';\r\nimport { FromSecArg, IRepoData, IRepoFactoryOptions, RepoFactory, Repository, selectDriver } from './base';\r\n\r\nexport type PartialWithId<T, IDValue, IDKey extends PropertyKey> = {\r\n  [key in IDKey]: IDValue;\r\n} & Partial<T>;\r\n\r\n\r\nexport interface IEntityRepoData<IDKey extends PropertyKey = PropertyKey> extends IRepoData {\r\n  readonly primaryKey?: IDKey;\r\n}\r\n\r\nexport interface IEntityRepoMethods<\r\n  C extends IStorableConstructor<E>,\r\n  E extends Entity = InstanceType<C>,\r\n  A extends ConstructorParameters<C>[0] = ConstructorParameters<C>[0],\r\n  R = any,\r\n  IDKey extends PropertyKey = E extends Entity<infer IdKey, any> ? IdKey : PropertyKey,\r\n  IDValue extends PropertyKey = E extends Entity<string, infer IdType> ? IdType : any\r\n> {\r\n  add(\r\n    options: A,\r\n    apiOptions?: any\r\n  ): Promise<R>;\r\n\r\n  get(\r\n    id: IDValue,\r\n    apiOptions?: any\r\n    ): Promise<R>;\r\n\r\n  update(\r\n    entity: PartialWithId<A, IDValue, IDKey>,\r\n    deleteApiOptions?: any\r\n  ): Promise<R>;\r\n\r\n  updateById(\r\n    id: IDValue,\r\n    query: (entity: A) => Partial<A>,\r\n    deleteApiOptions?: any\r\n  ): Promise<R>;\r\n\r\n  delete(\r\n    entity: Partial<A> | IDValue,\r\n    deleteApiOptions?: any\r\n  ): Promise<R>;\r\n\r\n  //...\r\n  // TODO - other methods\r\n}\r\n\r\nexport interface IEntityRepository<\r\n  C extends IStorableConstructor<E>,\r\n  E extends Entity = InstanceType<C>,\r\n  A extends ConstructorParameters<C>[0] = ConstructorParameters<C>[0],\r\n  IDKey extends PropertyKey = E extends Entity<infer IdKey, any> ? IdKey : PropertyKey,\r\n  IDValue extends PropertyKey = E extends Entity<string, infer IdType> ? IdType : any\r\n> extends IEntityRepoData<IDKey>, IEntityRepoMethods<C, E, A, QueryResult<E> | QueryResult<undefined>, IDKey, IDValue>, Debugable {}\r\n\r\nexport type EntityDataMap<\r\n  C extends IStorableConstructor<E>,\r\n  E extends Entity = InstanceType<C>,\r\n  A extends ConstructorParameters<C>[0] = ConstructorParameters<C>[0]\r\n> = Partial<IEntityRepoMethods<C, E, A, A | undefined>>;\r\n\r\n/**\r\n * A typical multi-entity repository.\r\n *\r\n * @template `DM` API data map for the repo\r\n * @template `C` entity constructor type\r\n * @template `E` entity instance type\r\n * @template `A` entity constructor parameter options\r\n * @template `ID` entity primary key type\r\n * @template `IDKey` entity primary key name\r\n */\r\nexport class EntityRepositoryClass<\r\n  DM extends EntityDataMap<C, E, A>,\r\n  C extends IStorableConstructor<E>,\r\n  E extends Entity = InstanceType<C>,\r\n  A extends ConstructorParameters<C>[0] = ConstructorParameters<C>[0],\r\n  IDKey extends PropertyKey = E extends Entity<infer IdKey, any> ? IdKey : PropertyKey,\r\n  IDValue extends PropertyKey = E extends Entity<string, infer IdType> ? IdType : PropertyKey\r\n> extends Repository<DM, C, E, A> implements IEntityRepository<C, E, A, IDKey, IDValue> {\r\n\r\n  public readonly primaryKey: IDKey;\r\n\r\n  constructor(\r\n    name: string,\r\n    connectionName: string,\r\n    public readonly currentDriver: Driver,\r\n    entity: C,\r\n    api?: DM,\r\n  ) {\r\n    super(name, connectionName, entity, api);\r\n\r\n    // If no unique ID is set for the entity\r\n    if (!entity.prototype.__idKey__) {\r\n      const falseInstance = new entity({}, this);\r\n      const defaultIdAliases = [ 'id', 'ID', 'Id', '_id', '_ID', '_Id', '__id', '__ID', '__Id', '__id__', '__ID__', '__Id__' ];\r\n      const key = Object.keys(falseInstance).find(key => defaultIdAliases.some(a => a === key));\r\n\r\n      // Auto-apply the ID decorator if found any compatible property\r\n      if (key) {\r\n        Entity.ID(entity.prototype, key);\r\n      } else {\r\n        this.$error(`No ID field is set for \"${entity.name}\".`);\r\n      }\r\n    }\r\n\r\n    this.primaryKey = entity.prototype.__idKey__;\r\n\r\n    if (this.primaryKey && !this.columns.includes(String(this.primaryKey))) {\r\n      this.columns.push(String(this.primaryKey));\r\n    }\r\n\r\n    delete entity.prototype.__idKey__;\r\n  }\r\n\r\n  private get driverOptions(): IEntityRepoData<IDKey> {\r\n    return {\r\n      name: this.name,\r\n      columns: this.columns,\r\n      primaryKey: this.primaryKey,\r\n      connectionName: this.connectionName\r\n    };\r\n  }\r\n\r\n  public async add(\r\n    options: A,\r\n    // TODO: up to debate - singular arguments always or multiple args inference?\r\n    apiOptions?: FromSecArg<DM['add']> | false // Pass false to disable the api call\r\n  ) {\r\n    try {\r\n      const result = await this.currentDriver.create<A, IEntityRepoData<IDKey>>(this.driverOptions, options);\r\n\r\n      const instance = this.makeDataInstance(result);\r\n\r\n      // Call local driver changes synchronously\r\n      const queryResult = new QueryResult(true, instance);\r\n\r\n      // Call api driver asynchronously\r\n      if (this.api && this.api.add && apiOptions !== false) {\r\n        this.$log(`API handler execution start: ${this.name}.add()`);\r\n\r\n        // @TODO: implement async request queue\r\n        this.api.add(options, apiOptions).then(res => {\r\n          if (typeof res !== 'undefined') {\r\n            queryResult.result = this.makeDataInstance(res);\r\n            this.$log(`API handler execution end: ${this.name}.add() => ${JSON.stringify(res, undefined, '  ')}`);\r\n          } else {\r\n            throw new TypeError('result is undefined');\r\n          }\r\n        }).catch(e => {\r\n          queryResult.error = e;\r\n          this.$error(`API handler execution end: ${this.name}.add() => ${e}`);\r\n        });\r\n      } else {\r\n        this.$log('No API handler called');\r\n      }\r\n\r\n      return queryResult;\r\n    } catch (e) {\r\n      this.$error(e);\r\n\r\n      return new QueryResult<E>(false, this.makeDataInstance(options), e);\r\n    }\r\n  }\r\n\r\n  public async get(\r\n    id: IDValue,\r\n    getApiOptions?: FromSecArg<DM['get']> | false\r\n  ) {\r\n    try {\r\n      const result = await this.currentDriver.findById<A, IEntityRepoData<IDKey>, IDValue>(this.driverOptions, id);\r\n\r\n      if (!result) {\r\n        throw new Error(`No results found for id ${id}`);\r\n      }\r\n\r\n      const instance = this.makeDataInstance(result);\r\n\r\n      // Call local driver changes synchronously\r\n      const queryResult = new QueryResult(true, instance);\r\n\r\n      // Call api driver asynchronously\r\n      if (this.api && this.api.get && getApiOptions !== false) {\r\n        this.$log(`API handler execution start: ${this.name}.get()`);\r\n\r\n        // @TODO: implement async request queue\r\n        this.api.get(id as any, getApiOptions).then(res => {\r\n          if (typeof res !== 'undefined') {\r\n            queryResult.result = this.makeDataInstance(res);\r\n            this.$log(`API handler execution end: ${this.name}.get() => ${JSON.stringify(res, undefined, '  ')}`);\r\n          } else {\r\n            throw new TypeError('result is undefined');\r\n          }\r\n        }).catch(e => {\r\n          queryResult.error = e;\r\n          this.$error(`API handler execution end: ${this.name}.get() => ${e}`);\r\n        });\r\n      } else {\r\n        this.$log('No API handler called');\r\n      }\r\n\r\n      return queryResult;\r\n    } catch (e) {\r\n      return new QueryResult(\r\n        false,\r\n        undefined,\r\n        e\r\n      );\r\n    }\r\n  }\r\n\r\n  public async update(\r\n    entity: PartialWithId<A, IDValue, IDKey>,\r\n    updateApiOptions?: FromSecArg<DM['update']>\r\n  ) {\r\n    throw new Error('Not implemented');\r\n\r\n    return new QueryResult(/* TODO: implement this */\r\n      true,\r\n      this.makeDataInstance({} as any)\r\n    );\r\n  }\r\n\r\n  /* Do we even need this?.. */\r\n  public async updateById(\r\n    id: IDValue,\r\n    query: (entity: A) => Partial<A>,\r\n    updateApiOptions?: FromSecArg<DM['update']>\r\n  ) {\r\n    throw new Error('Not implemented');\r\n\r\n    return new QueryResult(/* TODO: implement this */\r\n      true,\r\n      this.makeDataInstance(query({} as any) as any)\r\n    );\r\n  }\r\n\r\n  public async delete(\r\n    entity: Partial<A> | IDValue,\r\n    deleteApiOptions?: FromSecArg<DM['delete']> | false\r\n  ) {\r\n    throw new Error('Not implemented');\r\n\r\n    return new QueryResult(/* TODO: implement this */\r\n      true,\r\n      this.makeDataInstance({} as any)\r\n    );\r\n  }\r\n\r\n  // TODO: Find, find by, exists, etc...\r\n\r\n  public async count() {\r\n    // TODO: count entities\r\n  }\r\n\r\n  // TODO: Cluster operations\r\n}\r\n\r\nexport function EntityRepository<\r\n  D extends EntityDataMap<C, E, A>,\r\n  C extends IStorableConstructor<any>,\r\n  E extends Entity = InstanceType<C>,\r\n  A extends ConstructorParameters<C>[0] = ConstructorParameters<C>[0],\r\n  IDKey extends PropertyKey = E extends Entity<infer IdKey, any> ? IdKey : PropertyKey,\r\n  IDValue extends PropertyKey = E extends Entity<string, infer IdType> ? IdType : PropertyKey\r\n>(options: IRepoFactoryOptions<C, D> & {\r\n  dirvers?: IDriverConstructor | IDriverConstructor[];\r\n}): RepoFactory<EntityRepositoryClass<D, C, E, A, IDKey, IDValue>> {\r\n  return (name: string, connection: Connection) => new EntityRepositoryClass<D, C, E, A, IDKey, IDValue>(\r\n    name,\r\n    connection.name,\r\n    new (selectDriver(options.dirvers || FallbackDriver, name))(connection),\r\n    options.model,\r\n    options.api\r\n  );\r\n}\r\n","import { Connection } from '../connection/connection';\r\nimport { IStorableConstructor } from '../storable';\r\nimport { DataMap, IRepoFactoryOptions, RepoFactory, Repository } from './base';\r\n\r\nexport class RemoteRepositoryClass<\r\n  DM extends DataMap<C>,\r\n  C extends IStorableConstructor<any>\r\n> extends Repository<DM, C> {\r\n  public get API() {\r\n    return this.api!;\r\n  }\r\n}\r\n\r\nexport function RemoteRepository<\r\n  C extends IStorableConstructor<any>,\r\n  D extends DataMap<C>\r\n>(options: IRepoFactoryOptions<C, D>): RepoFactory<RemoteRepositoryClass<D, C>> {\r\n  return (name: string, connection: Connection) => new RemoteRepositoryClass<D, C>(\r\n    name,\r\n    connection.name,\r\n    options.model,\r\n    options.api\r\n  );\r\n}\r\n"],"names":["tslib_1.__decorate","tslib_1.__extends","Connection","connection","tslib_1.__assign"],"mappings":"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"}